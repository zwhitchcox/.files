#!/usr/bin/env bash

starts_with() {
  [[ $1 == $2* ]] && return 0
  return 1
}

if [ -z "$1" ]; then
  echo "Select a project"
  dev $(get_selection $(list_projects))
  return $?
fi

local cur_env=$(cat $ENV_FILE)
local paths=("${DEV_DIR}" "${DEV_DIR}/${cur_env}"  "")
local project=""
for p in ${paths[@]} ; do
  if [ -d "${p}/${1}/.git" ]; then
    project="$p/$1"
    break
  fi
done

if [ -z "$project" ]; then
  local create_dir=$cur_env/$1
  if getyn "Couldn't find project $1. Init project in $create_dir (Y/n)? "; then
    init_project $create_dir
    dev $create_dir
    return $?
  fi
  return 1
fi


if starts_with "$project" "$DEV_DIR"; then
  local p=${project:$((${#DEV_DIR}+1))}
  test "$p" != "." && echo "$p" >> $DEV_HIST
fi
if [ -z $TMUX ]; then
  tmux new-session -c $project 
else
  cd "$project"

  if [ -z $VIMRUNTIME ]; then
    vim .
  fi
fi


